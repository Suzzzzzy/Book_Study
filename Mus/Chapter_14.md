[ToC]

## 함께 논의하고 싶은 주제
- 비디오 서비스를 이용하는 유저들이 가장 중요하게 생각하는게 영상이 끊기지 않는것이라 들었습니다. 유튜브 같은 경우, 네트워크 상태에 따라서 자동으로 영상 품질을 바꿔주거나, 오프라인에서 재생할 수 있게 영상을 미리 받아주는 등 기술을 사용하는 것으로 알고 있습니다. 이러한 기능을 어떻게 구현을 해야할지 간단하게 의논해보는 시간을 갖고 싶습니다.

## 14장 - 유튜브 설계

### 1단계 - 문제 이해 및 설계 범위 확정
- 빠른 비디오 업로드
- 원활한 비디오 재생
- 재생 품질 선택 기능
- 낮은 인프라 비용
- 높은 가용성과 규모 확장성, 그리고 안정성
- 지원 클라이언트: 여러가지
- 개략적 규모 추정
  - **CDN 비용**

### 2단계 - 개략적 설계안 제시 및 동의 구하기
- CDN과 BLOB 스토리지 활용
  - 원래 설계는 밑바닥부터 만들지 않아요!
  - 저거 되게 어려운 기술이라 비용이 많이 듬
- 비디오 업로드 절차
  - 사용자
  - 로드밸런서
  - API 서버
  - 메타데이터 데이터베이스
  - 메타데이터 캐시
  - 원본 저장소
  - 트랜스코딩 서버: 비디오 인코딩이라고 부르는 것
  - 트랜스코딩 비디오 저장소
  - CDN
  - 트랜스코딩 오나료 큐
  - 트랜스코딩 완료 핸들러
  - 두 프로세스가 병력적으로 수행
    1. 비디오 업로드
    2. 비디오 메타데이터 갱신
- 비디오 스트리밍 절차
  - 비디오... 압축기술...

### 3단계 - 상세 설계
- 비디오 트랜스코딩
  - 가공되지 않은 원본 비디오는 저장 공간을 많이 차지
  - 단말들과 브라우저에 따라서 특정 비디오 포맷만 지원
  - 대여폭에 따라서 품질 다르게 전달
  - 모바일의 경우 네트워크 상태가 수실 ㅗ변경
  - 인코딩 포맷
    - 컨테이너
    - 코덱
- 유향 비순환 그래프 모델
  - 검사: 비디오 품질 검사
  - 비디오 인코딩
  - 섬네일
  - 워터마크
- 비디오 트랜스코딩 아키텍쳐
  - 전처리기
    1. 비디오 분할
    2. DAG 생성
    3. 데이터 캐시
  - DAG 스캐쥴러
    - 단계별로 분할하여 관리자의 작업 큐에 집어넣음
    - 작업 큐
    - 작업 서버 큐
    - 실행 큐
    - 작업 스케쥴러
  - 작업 서버
  - 임시 저장소
  - 인코딩된 비디오
- 시스템 최적화
  - 속도 최적화: 비디오 병렬 업로드
  - 속도 최적화: 업로드 센터를 사용자 근거리에 지정
  - 속도 최적화: 모든 절차를 병렬화
  - 안정성 최적화: 미리 사인된 업로드 URL
    - pre-signed가 이런 의미구나..
    1. 클라이언트가 서버에 요청하여 미리 사인된 URL을 받음
    2. API 서버는 미리 사인된 URL 돌려줌
    3. 클라이언트는 해당 URL이 가리키는 위치에 비디오를 업로드
  - 안정성 최적화: 비디오 보호
    - 디지털 저작권 관리(DRM)
    - AES 암호화
    - 워터마크
  - 비용 최적화
- 오류 처리
  - 회복 가능 오류
  - 회복 불가능 오류
  - 에러별 오류 처리 방법

### 4단계 - 마무리
추카포카 :tada::tada::tada: