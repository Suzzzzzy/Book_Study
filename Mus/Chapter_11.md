[ToC]

## 11장 - 뉴스 피드 시스템 설계
| 뉴스 피드(news feed)란 무엇인가???

### 1단계 - 문제 이해 및 설계 범위 확정

### 2단계 - 개략적 설계안 제시 및 동의 구하기
고민해야 할 부분은 아래 두개
1. 피드 발행
2. 뉴스 피드 생성

#### 뉴스 피드 API
- 피드 발행 API
  - 인자
    - Body
    - Authorization 헤더
- 피드 읽기 API
  - 인자
    - Authorization 헤더

#### 피드 발행
- 사용자
- 로드 밸런서
- 웹 서버: HTTP 요청을 내부 서비스로 중계하는 역할을 담당
- 포스팅 저장 서비스: 새 포스팅을 데이터베이스와 캐시에 저장
- 포스팅 전송 서비스
- 알림 서비스

#### 뉴스피드 생성
- 사용자
- 로드 밸런서
- 웹 서버: 트래픽을 뉴스 피드 서비스로 보낸다
- 뉴스 피드 서비스: 캐시에서 뉴스 피드를 가져오는 서비스
- 뉴스 피드 캐시: 뉴스 피드를 렌더링할 때 필요한 피드 ID를 보관

### 3단계 - 상세 설계
#### 피드 발생 흐름 상세 설계
- 웹서버
  - 클라이언트와 통신
  - 인증이나 저리율 제한 등의 기능도 수행
- 포스팅 전송(팬아웃) 서비스
  - 팬아웃: 어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달
    - 쓰기 시점에 팬아웃
      - 장점 
        - 친구 목록에 있는 사용자에게 즉시 전송
        - 뉴스 피드를 읽는 데 드는 시간이 짧음
      - 단점
        - 인싸는 갱신 시간이 오래 걸림 -> 핫키문제
        - 서비스를 자주 사용하지 않는 사람까지 조회해야 해서 리소스 낭비
    - 읽기 시점의 팬아웃
      - 장점
        - 비활성화된 사용자는 자원을 아낄 수 있어서 유리
        - 핫키 문제도 생기지 않음
      - 단점
        - 뉴스 피드 조회가 오래 걸림
    - 두개 장점 합치기
      - 풀 모델(?) 사용하여 시스템 과부화를 방지
        - 풀모델이 뭔지 설명이 시급합니다
      - 안정 해시를 통해 핫키 문제 삭제

#### 피드 읽기 흐름 상세 설계
1. 사용자가 피드 읽으려는 요청
2. 로드밸런서가 서버에게 요청
3. 서버는 뉴스 피드 서비스 호출
4. 캐시에서 포스팅 ID 목록 조회
5. 콘텐츠를 사용자 캐시와 포스팅 캐시에서 가져와서 완전한 뉴스피드 생성
6. JSON 형태로 클라이언트에 전송하여 렌더링

#### 캐시 구조
- 뉴스 피드
- 콘텐츠
- 소셜 그래프
- 행동
- 횟수

### 4단계 - 마무리
추카포카 :tada::tada::tada:

## 함께 논의하고 싶은 주제
- 저희 서비스는 일반적으로 페이스북이랑 인스타그램 피드와는 차별화되어 사물에 대한 피드도 있는데, 팔로워, 사물에 대한 피드 조회 방법이 다를까요?

