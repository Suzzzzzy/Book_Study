[ToC]

## 함께 논의하고 싶은 주제
- 

## 15장 - 구글 드라이브 설계

### 1단계 - 문제 이해 및 설계 범위 확정
- 기능
  - 파일 추가
  - 파일 다운로드
  - 여러 단말에 파일 동기화
  - 파일 갱신 이력 조회
  - 파일 공유
  - 알림 표시
- 안할 기능
  - 동시 편집
- 비기능
  - 안정성
  - 빠른 동기화 속도
  - 네트워크 대역폭
  - 규모 확장성
  - 높은 가용성
- 개략적 추정치

### 2단계 - 개략적 설계안 제시 및 동의 구하기
- API
  1. 파일 업로드 API
    - 단순 업로드
    - 이어 올리기
      1. 이어 올리기 URL을 받기 위한 최초 요청 전송
      2. 데이터를 업로드하고 업로드 상태 모니터링
      3. 업로드에 장애가 발생하면 장애 발새잇점부터 업로드를 재시작
  2. 파일 다운로드 AIP
  3. 파일 갱신 히스토리 API
- 한 대 서버의 제약 극폭
  - S3 뿐이야...
- 동기화 충돌
- 개략적 설계안
  - 사용자 단말
  - 블록 저장소 서버
  - 클라우드 저장소
  - 아카이빙 저장소
  - 로드밸런서
  - API 서버
  - 메타데이터 데이터베이스
  - 메타데이터 캐시
  - 알림 서비스
  - 오프라인 사용자 백업 큐

### 3단계 - 상세 설계
- 블록 저장소 서버
  - 델터 동기화: 수정된 블록만 동기화
  - 압축
  - 동작 순서
    1. 주어진 파ㅏ일을 작은 블록들로 분할
    2. 각 블록을 압축
    3. 암호화
    4. 클라우드 저장소로 전송
- 높은 일관성 요구사항
  - 캐시에 보관된 사본과 데이터베이스에 있는 원본이 일치
  - 변경이 발생하면 캐시에 있는 사본 뮤효화
- 메타데이터 데이터베이스
- 업로드 절차
  - 파일 메타데이터 추가
  - 파일을 클라우드 저장소에 업로드
- 다운로드 절차
- 알림 서비스
  - **롱 폴링**
    - 양방향 통신이 필요 없음
    - 알림을 보낼일이 그렇게 많지 않으  
  - 웹소캣
- 저장소 공간 절약
  - 중복 제거
  - 지능적 백업 전략을 도입
    - 한도 설정
    - 중요한 버전만 보관
  - 자주 쓰이지 않는 데이터는 아카이빙 저장소로 옮김
- 장애처리
  - 로드밸런스 장애: 헐트비트로 모니터링
  - 블록 저장소 서버 장애: 다른 서버가 이어 받음
  - 클라우드 저장소 장애: 다중화
  - API 서버 장애: 트래픽을 해당 서버로 보내지 않고 격리
  - 메타데이터 캐시 장애: 다중화
  - 메타데이터 데이터베이스 장애
    - 주: 부를 주로 바꾸고 부 하나 추가
    - 부: 다른 부에 읽기 처리 부탁하고 새로 추가
  - 알림 서비스 장애
  - 오프라인 사용자 백업 큐 장애: 구독 관계 재설정

### 4단계 - 마무리
- 블록 저장소를 거치지 않고 클라우드 저장소에 직접 업로드
  - 장점
    - 빠름
  - 단점
    - 플랫폼별로 따로 구현해야함
    - 클라이언트가 해킹 달한 가능성이 있음
**다들 정말 고생이 많으셨습니다.**
추카포카 :tada::tada::tada: