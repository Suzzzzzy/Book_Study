# chapter 8 URL 단축기 설계

### API 엔드포인트
URL 단축기는 두개의 엔드포인트를 필요로 한다
- URL 단축용 엔드포인트: 새 단축 URL을 생성하고자 하는 클라이언트가 이 엔드포인트에 단축할 URL을 인자로 POST 요청 보냄
- URL 리디렉션용 엔드포인트: 단축 URL에 대해 요청이 오면 원래 URL로 보내주기 위한 엔드포인트

### 리디렉션
클라이언트가 단축 URL 방문 -> 원래 URL로 바꾸어 301응답의 location 헤더에 반환 -> 클라이언트는 원래 URL로 방문

- 301응답: 해당 URL에 대한 HTTP 요청의 처리 책임이 영구적으로 location 헤더에 반환된 URL로 이전
  - 브라우저는 이 응답을 캐시 -> 같은 요청 오면 캐시된 원래 URL로 요청 보내게 됨
- 302응답: 일시적으로 location 헤더가 지정하는 URL에 의해 처리

## URL 단축, 리디렉션 처리 설계 방법
1. 데이터 모델
- 해시 테이블을 두어도 좋지만, 메모리가 비쌈
- 관계형 데이터베이스에 순서쌍(단축 URL / 원래 URL) 저장

2. 해시 함수
- 해시 함수가 원래 URL을 단축 URL로 변환
- 7글자로 줄인다고 했을 때 가장 짧은 해시 함수도 7글자를 넘는다면?
  - 처음 7글자만 사용 -> 충돌 확률 생김
  - 충돌이 해소될 때 까지 사전에 정한 문자열을 해시값에 덧붙인다
  - 그러나, 충돌을 줄일 수는 있지만 데이터에 한 번 이상 조회해야 하므로 오버헤드

3. 로드밸런서
- 사용자가 단축 URL 클릭 -> 로드밸런서가 요청을 웹서버에 전달 -> 캐시에 있는 경우 바로 원래 URL을 클라이언트에 전달 -> 캐시에 없는 경우 데이터베이스에서 조회


# 논의주제
rest api 에 만 해당하는 설계인가요? gRPC로 통신하는 경우는 URL 단축에 대해 고려하지 않아도 되는건가요?